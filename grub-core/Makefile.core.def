AutoGen definitions Makefile.tpl;

transform_data = {
  installdir = noinst;
  name = gensyminfo.sh;
  common = gensyminfo.sh.in;
};

transform_data = {
  installdir = noinst;
  name = genmod.sh;
  common = genmod.sh.in;
};

transform_data = {
  installdir = noinst;
  name = modinfo.sh;
  common = modinfo.sh.in;
};

transform_data = {
  installdir = platform;
  name = gmodule.pl;
  common = gmodule.pl.in;
};

transform_data = {
  installdir = platform;
  name = gdb_grub;
  common = gdb_grub.in;
};

transform_data = {
  installdir = platform;
  name = grub.chrp;
  common = boot/powerpc/grub.chrp.in;
  enable = powerpc_ieee1275;
};

transform_data = {
  installdir = platform;
  name = bootinfo.txt;
  common = boot/powerpc/bootinfo.txt.in;
  enable = powerpc_ieee1275;
};

kernel = {
  name = kernel;

  nostrip = emu;

  emu_ldflags              = '-Wl,-r,-d';
  i386_efi_ldflags         = '-Wl,-r,-d';
  i386_efi_stripflags      = '--strip-unneeded -K start -R .note -R .comment -R .note.gnu.gold-version';
  x86_64_efi_ldflags       = '-Wl,-r,-d';
  x86_64_efi_stripflags    = '--strip-unneeded -K start -R .note -R .comment -R .note.gnu.gold-version';

  ia64_efi_cflags = '-fno-builtin -fpic -minline-int-divide-max-throughput';
  ia64_efi_ldflags = '-Wl,-r,-d';
  ia64_efi_stripflags = '--strip-unneeded -K start -R .note -R .comment -R .note.gnu.gold-version';

  arm_efi_ldflags          = '-Wl,-r,-d';
  arm_efi_stripflags       = '--strip-unneeded -K start -R .note -R .comment -R .note.gnu.gold-version';

  arm64_efi_ldflags          = '-Wl,-r,-d';
  arm64_efi_stripflags       = '--strip-unneeded -K start -R .note -R .comment -R .note.gnu.gold-version -R .eh_frame';

  i386_pc_ldflags          = '$(TARGET_IMG_LDFLAGS)';
  i386_pc_ldflags          = '$(TARGET_IMG_BASE_LDOPT),0x9000';
  i386_qemu_ldflags        = '$(TARGET_IMG_LDFLAGS)';
  i386_qemu_ldflags        = '$(TARGET_IMG_BASE_LDOPT),0x9000';
  i386_coreboot_ldflags    = '$(TARGET_IMG_LDFLAGS)';
  i386_coreboot_ldflags    = '$(TARGET_IMG_BASE_LDOPT),0x9000';
  i386_multiboot_ldflags   = '$(TARGET_IMG_LDFLAGS)';
  i386_multiboot_ldflags   = '$(TARGET_IMG_BASE_LDOPT),0x9000';
  i386_ieee1275_ldflags    = '$(TARGET_IMG_LDFLAGS)';
  i386_ieee1275_ldflags    = '$(TARGET_IMG_BASE_LDOPT),0x10000';
  i386_xen_ldflags         = '$(TARGET_IMG_LDFLAGS)';
  i386_xen_ldflags         = '$(TARGET_IMG_BASE_LDOPT),0';
  x86_64_xen_ldflags       = '$(TARGET_IMG_LDFLAGS)';
  x86_64_xen_ldflags       = '$(TARGET_IMG_BASE_LDOPT),0';

  mips_loongson_ldflags    = '-Wl,-Ttext,0x80200000';
  powerpc_ieee1275_ldflags = '-Wl,-Ttext,0x200000';
  sparc64_ieee1275_ldflags = '-Wl,-Ttext,0x4400';
  mips_arc_ldflags    = '-Wl,-Ttext,$(TARGET_LINK_ADDR)';
  mips_qemu_mips_ldflags    = '-Wl,-Ttext,0x80200000';

  mips_arc_cppflags = '-DGRUB_DECOMPRESSOR_LINK_ADDR=$(TARGET_DECOMPRESSOR_LINK_ADDR)';
  i386_qemu_cppflags     = '-DGRUB_BOOT_MACHINE_LINK_ADDR=$(GRUB_BOOT_MACHINE_LINK_ADDR)';
  emu_cflags = '$(CFLAGS_GNULIB)';
  emu_cppflags = '$(CPPFLAGS_GNULIB)';
  arm_uboot_ldflags       = '-Wl,-r,-d';
  arm_uboot_stripflags    = '--strip-unneeded -K start -R .note -R .comment -R .note.gnu.gold-version';
  arm_coreboot_ldflags       = '-Wl,-r,-d';
  arm_coreboot_stripflags    = '--strip-unneeded -K start -R .note -R .comment -R .note.gnu.gold-version';

  i386_pc_startup = kern/i386/pc/startup.S;
  i386_efi_startup = kern/i386/efi/startup.S;
  x86_64_efi_startup = kern/x86_64/efi/startup.S;
  i386_xen_startup = kern/i386/xen/startup.S;
  x86_64_xen_startup = kern/x86_64/xen/startup.S;
  i386_qemu_startup = kern/i386/qemu/startup.S;
  i386_ieee1275_startup = kern/i386/ieee1275/startup.S;
  i386_coreboot_startup = kern/i386/coreboot/startup.S;
  i386_multiboot_startup = kern/i386/coreboot/startup.S;
  mips_startup = kern/mips/startup.S;
  sparc64_ieee1275_startup = kern/sparc64/ieee1275/crt0.S;
  powerpc_ieee1275_startup = kern/powerpc/ieee1275/startup.S;
  arm_uboot_startup = kern/arm/startup.S;
  arm_coreboot_startup = kern/arm/startup.S;
  arm_efi_startup = kern/arm/efi/startup.S;
  arm64_efi_startup = kern/arm64/efi/startup.S;

  common = kern/command.c;
  common = kern/corecmd.c;
  common = kern/device.c;
  common = kern/disk.c;
  common = kern/dl.c;
  common = kern/env.c;
  common = kern/err.c;
  common = kern/file.c;
  common = kern/fs.c;
  common = kern/list.c;
  common = kern/main.c;
  common = kern/misc.c;
  common = kern/parser.c;
  common = kern/partition.c;
  common = kern/rescue_parser.c;
  common = kern/rescue_reader.c;
  common = kern/term.c;

  noemu = kern/compiler-rt.c;
  noemu = kern/mm.c;
  noemu = kern/time.c;
  noemu = kern/generic/millisleep.c;

  noemu_nodist = symlist.c;

  mips = kern/generic/rtc_get_time_ms.c;

  ieee1275 = disk/ieee1275/ofdisk.c;
  ieee1275 = kern/ieee1275/cmain.c;
  ieee1275 = kern/ieee1275/ieee1275.c;
  ieee1275 = kern/ieee1275/mmap.c;
  ieee1275 = kern/ieee1275/openfw.c;
  ieee1275 = term/ieee1275/console.c;
  ieee1275 = kern/ieee1275/init.c;

  uboot = disk/uboot/ubootdisk.c;
  uboot = kern/uboot/uboot.c;
  uboot = kern/uboot/init.c;
  uboot = kern/uboot/hw.c;
  uboot = term/uboot/console.c;
  arm_uboot = kern/arm/uboot/init.c;
  arm_uboot = kern/arm/uboot/uboot.S;

  arm_coreboot = kern/arm/coreboot/init.c;
  arm_coreboot = kern/arm/coreboot/timer.c;
  arm_coreboot = kern/arm/coreboot/coreboot.S;
  arm_coreboot = lib/fdt.c;
  arm_coreboot = bus/fdt.c;
  arm_coreboot = term/ps2.c;
  arm_coreboot = term/arm/pl050.c;
  arm_coreboot = term/arm/cros.c;
  arm_coreboot = term/arm/cros_ec.c;
  arm_coreboot = bus/spi/rk3288_spi.c;
  arm_coreboot = commands/keylayouts.c;
  arm_coreboot = kern/arm/coreboot/dma.c;

  terminfoinkernel = term/terminfo.c;
  terminfoinkernel = term/tparm.c;
  terminfoinkernel = commands/extcmd.c;
  terminfoinkernel = lib/arg.c;

  softdiv = lib/division.c;

  i386 = kern/i386/dl.c;
  i386_xen = kern/i386/dl.c;

  i386_coreboot = kern/i386/coreboot/init.c;
  i386_multiboot = kern/i386/coreboot/init.c;
  i386_qemu = kern/i386/qemu/init.c;
  i386_coreboot_multiboot_qemu = term/i386/pc/vga_text.c;
  coreboot = video/coreboot/cbfb.c;

  efi = disk/efi/efidisk.c;
  efi = kern/efi/efi.c;
  efi = kern/efi/init.c;
  efi = kern/efi/mm.c;
  efi = term/efi/console.c;
  efi = kern/acpi.c;
  efi = kern/efi/acpi.c;
  i386_coreboot = kern/i386/pc/acpi.c;
  i386_multiboot = kern/i386/pc/acpi.c;
  i386_coreboot = kern/acpi.c;
  i386_multiboot = kern/acpi.c;

  x86 = kern/i386/tsc.c;
  x86 = kern/i386/tsc_pit.c;
  i386_efi = kern/i386/efi/tsc.c;
  x86_64_efi = kern/i386/efi/tsc.c;
  i386_efi = kern/i386/tsc_pmtimer.c;
  i386_coreboot = kern/i386/tsc_pmtimer.c;
  x86_64_efi = kern/i386/tsc_pmtimer.c;

  i386_efi = kern/i386/efi/init.c;
  i386_efi = bus/pci.c;

  x86_64 = kern/x86_64/dl.c;
  x86_64_xen = kern/x86_64/dl.c;
  x86_64_efi = kern/x86_64/efi/callwrap.S;
  x86_64_efi = kern/i386/efi/init.c;
  x86_64_efi = bus/pci.c;

  xen = kern/i386/tsc.c;
  xen = kern/i386/xen/tsc.c;
  x86_64_xen = kern/x86_64/xen/hypercall.S;
  i386_xen = kern/i386/xen/hypercall.S;
  xen = kern/xen/init.c;
  xen = term/xen/console.c;
  xen = disk/xen/xendisk.c;
  xen = commands/boot.c;

  ia64_efi = kern/ia64/efi/startup.S;
  ia64_efi = kern/ia64/efi/init.c;
  ia64_efi = kern/ia64/dl.c;
  ia64_efi = kern/ia64/dl_helper.c;
  ia64_efi = kern/ia64/cache.c;

  arm_efi = kern/arm/efi/init.c;
  arm_efi = kern/arm/efi/misc.c;
  arm_efi = kern/efi/fdt.c;

  arm64_efi = kern/arm64/efi/init.c;
  arm64_efi = kern/efi/fdt.c;

  i386_pc = kern/i386/pc/init.c;
  i386_pc = kern/i386/pc/mmap.c;
  i386_pc = term/i386/pc/console.c;

  i386_qemu = bus/pci.c;
  i386_qemu = kern/vga_init.c;
  i386_qemu = kern/i386/qemu/mmap.c;

  coreboot = kern/coreboot/mmap.c;
  i386_coreboot = kern/i386/coreboot/cbtable.c;
  coreboot = kern/coreboot/cbtable.c;
  arm_coreboot = kern/arm/coreboot/cbtable.c;

  i386_multiboot = kern/i386/multiboot_mmap.c;

  mips = kern/mips/cache.S;
  mips = kern/mips/dl.c;
  mips = kern/mips/init.c;

  mips_qemu_mips = kern/mips/qemu_mips/init.c;
  mips_qemu_mips = term/ns8250.c;
  mips_qemu_mips = term/serial.c;
  mips_qemu_mips = term/at_keyboard.c;
  mips_qemu_mips = term/ps2.c;
  mips_qemu_mips = commands/boot.c;
  mips_qemu_mips = commands/keylayouts.c;
  mips_qemu_mips = term/i386/pc/vga_text.c;
  mips_qemu_mips = kern/vga_init.c;

  mips_arc = kern/mips/arc/init.c;
  mips_arc = term/arc/console.c;
  mips_arc = disk/arc/arcdisk.c;

  mips_loongson = term/ns8250.c;
  mips_loongson = bus/bonito.c;
  mips_loongson = bus/cs5536.c;
  mips_loongson = bus/pci.c;
  mips_loongson = kern/mips/loongson/init.c;
  mips_loongson = term/at_keyboard.c;
  mips_loongson = term/ps2.c;
  mips_loongson = commands/boot.c;
  mips_loongson = term/serial.c;
  mips_loongson = video/sm712.c;
  mips_loongson = video/sis315pro.c;
  mips_loongson = video/radeon_fuloong2e.c;
  mips_loongson = video/radeon_yeeloong3a.c;
  extra_dist = video/sm712_init.c;
  extra_dist = video/sis315_init.c;
  mips_loongson = commands/keylayouts.c;

  powerpc_ieee1275 = kern/powerpc/cache.S;
  powerpc_ieee1275 = kern/powerpc/dl.c;
  powerpc_ieee1275 = kern/powerpc/compiler-rt.S;

  sparc64_ieee1275 = kern/sparc64/cache.S;
  sparc64_ieee1275 = kern/sparc64/dl.c;
  sparc64_ieee1275 = kern/sparc64/ieee1275/ieee1275.c;

  arm = kern/arm/dl.c;
  arm = kern/arm/dl_helper.c;
  arm = kern/arm/cache_armv6.S;
  arm = kern/arm/cache_armv7.S;
  extra_dist = kern/arm/cache.S;
  arm = kern/arm/cache.c;
  arm = kern/arm/compiler-rt.S;

  arm64 = kern/arm64/cache.c;
  arm64 = kern/arm64/cache_flush.S;
  arm64 = kern/arm64/dl.c;
  arm64 = kern/arm64/dl_helper.c;

  emu = disk/host.c;
  emu = kern/emu/cache_s.S;
  emu = kern/emu/hostdisk.c;
  emu = osdep/unix/hostdisk.c;
  emu = osdep/exec.c;
  extra_dist = osdep/unix/exec.c;
  emu = osdep/devmapper/hostdisk.c;
  emu = osdep/hostdisk.c;
  emu = kern/emu/hostfs.c;
  emu = kern/emu/main.c;
  emu = kern/emu/argp_common.c;
  emu = kern/emu/misc.c;
  emu = kern/emu/mm.c;
  emu = kern/emu/time.c;
  emu = kern/emu/cache.c;
  emu = osdep/emuconsole.c;
  extra_dist = osdep/unix/emuconsole.c;
  extra_dist = osdep/windows/emuconsole.c;
  emu = osdep/dl.c;
  extra_dist = osdep/unix/dl.c;
  extra_dist = osdep/windows/dl.c;
  emu = osdep/sleep.c;
  emu = osdep/init.c;
  emu = osdep/emunet.c;
  extra_dist = osdep/linux/emunet.c;
  extra_dist = osdep/basic/emunet.c;
  emu = osdep/cputime.c;
  extra_dist = osdep/unix/cputime.c;
  extra_dist = osdep/windows/cputime.c;

  videoinkernel = term/gfxterm.c;
  videoinkernel = font/font.c;
  videoinkernel = font/font_cmd.c;
  videoinkernel = io/bufio.c;
  videoinkernel = video/fb/fbblit.c;
  videoinkernel = video/fb/fbfill.c;
  videoinkernel = video/fb/fbutil.c;
  videoinkernel = video/fb/video_fb.c;
  videoinkernel = video/video.c;

  extra_dist = kern/i386/int.S;
  extra_dist = kern/i386/realmode.S;
  extra_dist = boot/i386/pc/lzma_decode.S;
  extra_dist = kern/mips/cache_flush.S;
};

image = {
  name = lzma_decompress;
  i386_pc = boot/i386/pc/startup_raw.S;
  i386_pc_nodist = rs_decoder.h;

  objcopyflags = '-O binary';
  ldflags = '$(TARGET_IMG_LDFLAGS) $(TARGET_IMG_BASE_LDOPT),0x8200';
  enable = i386_pc;
};

module = {
  name = disk;
  common = lib/disk.c;
  extra_dist = kern/disk_common.c;
};

module = {
  name = trig;
  common_nodist = trigtables.c;
  extra_dist = gentrigtables.c;
};

module = {
  name = cs5536;
  x86 = bus/cs5536.c;
  enable = x86;
};


module = {
  name = pci;
  common = bus/pci.c;
  i386_ieee1275 = bus/i386/ieee1275/pci.c;

  enable = i386_pc;
  enable = i386_ieee1275;
  enable = i386_coreboot;
  enable = i386_multiboot;
};

module = {
  name = nativedisk;
  common = commands/nativedisk.c;

  enable = x86;
  enable = mips_loongson;
  enable = mips_qemu_mips;
};

module = {
  name = cmostest;
  common = commands/i386/cmostest.c;
  enable = cmos;
};

module = {
  name = cmosdump;
  common = commands/i386/cmosdump.c;
  enable = cmos;
};

module = {
  name = iorw;
  common = commands/iorw.c;
  enable = x86;
};

module = {
  name = cbtable;
  common = kern/i386/coreboot/cbtable.c;
  common = kern/coreboot/cbtable.c;
  enable = i386_pc;
  enable = i386_efi;
  enable = i386_qemu;
  enable = i386_multiboot;
  enable = i386_ieee1275;
  enable = x86_64_efi;
};

module = {
  name = cbtime;
  common = commands/i386/coreboot/cb_timestamps.c;
  enable = x86;
};

module = {
  name = cbls;
  common = commands/i386/coreboot/cbls.c;
  enable = x86;
};

module = {
  name = cbmemc;
  common = term/i386/coreboot/cbmemc.c;
  enable = x86;
};

module = {
  name = regexp;
  common = commands/regexp.c;
  common = commands/wildcard.c;
  common = gnulib/regex.c;
  cflags = '$(CFLAGS_POSIX) $(CFLAGS_GNULIB)';
  cppflags = '$(CPPFLAGS_POSIX) $(CPPFLAGS_GNULIB)';
};

module = {
  name = acpi;

  common = commands/acpi.c;
  i386_pc = kern/acpi.c;
  i386_pc = kern/i386/pc/acpi.c;

  enable = efi;
  enable = i386_pc;
  enable = i386_coreboot;
  enable = i386_multiboot;
};

module = {
  name = lsacpi;

  common = commands/lsacpi.c;

  enable = efi;
  enable = i386_pc;
  enable = i386_coreboot;
  enable = i386_multiboot;
};

module = {
  name = blocklist;
  common = commands/blocklist.c;
};

module = {
  name = boot;
  common = commands/boot.c;
  i386_pc = lib/i386/pc/biosnum.c;
  enable = x86;
  enable = emu;
  enable = sparc64_ieee1275;
  enable = powerpc_ieee1275;
  enable = mips_arc;
  enable = ia64_efi;
  enable = arm_efi;
  enable = arm64_efi;
  enable = arm_uboot;
  enable = arm_coreboot;
};

module = {
  name = cat;
  common = commands/cat.c;
};

module = {
  name = cmp;
  common = commands/cmp.c;
};

module = {
  name = configfile;
  common = commands/configfile.c;
};

module = {
  name = cpuid;
  common = commands/i386/cpuid.c;
  enable = x86;
  enable = i386_xen;
  enable = x86_64_xen;
};

module = {
  name = date;
  common = commands/date.c;
};

module = {
  name = echo;
  common = commands/echo.c;
};

module = {
  name = eval;
  common = commands/eval.c;
};

module = {
  name = extcmd;
  common = commands/extcmd.c;
  common = lib/arg.c;
  enable = terminfomodule;
};

module = {
  name = halt;
  nopc = commands/halt.c;
  i386_pc = commands/i386/pc/halt.c;
  i386_pc = commands/acpihalt.c;
  i386_coreboot = commands/acpihalt.c;
  i386_multiboot = commands/acpihalt.c;
  i386_efi = commands/acpihalt.c;
  x86_64_efi = commands/acpihalt.c;
  i386_multiboot = lib/i386/halt.c;
  i386_coreboot = lib/i386/halt.c;
  i386_qemu = lib/i386/halt.c;
  xen = lib/xen/halt.c;
  efi = lib/efi/halt.c;
  ieee1275 = lib/ieee1275/halt.c;
  emu = lib/emu/halt.c;
  uboot = lib/dummy/halt.c;
  arm_coreboot = lib/dummy/halt.c;
};

module = {
  name = reboot;
  i386 = lib/i386/reboot.c;
  i386 = lib/i386/reboot_trampoline.S;
  powerpc_ieee1275 = lib/ieee1275/reboot.c;
  sparc64_ieee1275 = lib/ieee1275/reboot.c;
  mips_arc = lib/mips/arc/reboot.c;
  mips_loongson = lib/mips/loongson/reboot.c;
  mips_qemu_mips = lib/mips/qemu_mips/reboot.c;
  xen = lib/xen/reboot.c;
  uboot = lib/uboot/reboot.c;
  arm_coreboot = lib/dummy/reboot.c;
  common = commands/reboot.c;
};

module = {
  name = hashsum;
  common = commands/hashsum.c;
};

module = {
  name = help;
  common = commands/help.c;
};

module = {
  name = hexdump;
  common = commands/hexdump.c;
  common = lib/hexdump.c;
};

module = {
  name = keystatus;
  common = commands/keystatus.c;
};
module = {
  name = loadenv;
  common = commands/loadenv.c;
  common = lib/envblk.c;
};

module = {
  name = ls;
  common = commands/ls.c;
};

module = {
  name = lsmmap;
  common = commands/lsmmap.c;
};

module = {
  name = lspci;
  common = commands/lspci.c;

  enable = pci;
};

module = {
  name = memrw;
  common = commands/memrw.c;
};

module = {
  name = minicmd;
  common = commands/minicmd.c;
};

module = {
  name = parttool;
  common = commands/parttool.c;
};

module = {
  name = play;
  x86 = commands/i386/pc/play.c;
  enable = x86;
};

module = {
  name = spkmodem;
  x86 = term/spkmodem.c;
  enable = x86;
};

module = {
  name = morse;
  x86 = term/morse.c;
  enable = x86;
};

module = {
  name = probe;
  common = commands/probe.c;
};

module = {
  name = read;
  common = commands/read.c;
};

module = {
  name = search;
  common = commands/search_wrap.c;
  extra_dist = commands/search.c;
};

module = {
  name = search_fs_file;
  common = commands/search_file.c;
};

module = {
  name = search_fs_uuid;
  common = commands/search_uuid.c;
};

module = {
  name = search_label;
  common = commands/search_label.c;
};

module = {
  name = setpci;
  common = commands/setpci.c;
  enable = pci;
};

module = {
  name = pcidump;
  common = commands/pcidump.c;
  enable = pci;
};

module = {
  name = sleep;
  common = commands/sleep.c;
};

module = {
  name = terminal;
  common = commands/terminal.c;
};

module = {
  name = test;
  common = commands/test.c;
};

module = {
  name = true;
  common = commands/true.c;
};

module = {
  name = loopback;
  common = disk/loopback.c;
};

module = {
  name = diskfilter;
  common = disk/diskfilter.c;
};

module = {
  name = memdisk;
  common = disk/memdisk.c;
};

module = {
  name = procfs;
  common = fs/proc.c;
};

module = {
  name = archelp;
  common = fs/archelp.c;
};

module = {
  name = cbfs;
  common = fs/cbfs.c;
};

module = {
  name = cpio;
  common = fs/cpio.c;
};

module = {
  name = macbless;
  common = commands/macbless.c;
};

module = {
  name = gettext;
  common = gettext/gettext.c;
};

module = {
  name = hello;
  common = hello/hello.c;
};

module = {
  name = offsetio;
  common = io/offset.c;
};

module = {
  name = bufio;
  common = io/bufio.c;
  enable = videomodules;
};

module = {
  name = elf;
  common = kern/elf.c;

  extra_dist = kern/elfXX.c;
};

module = {
  name = tar;
  common = fs/tar.c;
};

module = {
  name = crypto;
  common = lib/crypto.c;
};

module = {
  name = relocator;
  common = lib/relocator.c;
  x86 = lib/i386/relocator16.S;
  x86 = lib/i386/relocator32.S;
  x86 = lib/i386/relocator64.S;
  i386 = lib/i386/relocator_asm.S;
  x86_64 = lib/x86_64/relocator_asm.S;
  i386_xen = lib/i386/relocator_asm.S;
  x86_64_xen = lib/x86_64/relocator_asm.S;
  x86 = lib/i386/relocator.c;
  x86 = lib/i386/relocator_common_c.c;
  ieee1275 = lib/ieee1275/relocator.c;
  efi = lib/efi/relocator.c;
  mips = lib/mips/relocator_asm.S;
  mips = lib/mips/relocator.c;
  powerpc = lib/powerpc/relocator_asm.S;
  powerpc = lib/powerpc/relocator.c;
  xen = lib/xen/relocator.c;
  i386_xen = lib/i386/xen/relocator.S;
  x86_64_xen = lib/x86_64/xen/relocator.S;
  xen = lib/i386/relocator_common_c.c;
  x86_64_efi = lib/x86_64/efi/relocator.c;

  extra_dist = lib/i386/relocator_common.S;
  extra_dist = kern/powerpc/cache_flush.S;

  enable = mips;
  enable = powerpc;
  enable = x86;
  enable = xen;
};

module = {
  name = datetime;
  cmos = lib/cmos_datetime.c;
  efi = lib/efi/datetime.c;
  uboot = lib/dummy/datetime.c;
  arm_coreboot = lib/dummy/datetime.c;
  sparc64_ieee1275 = lib/ieee1275/datetime.c;
  powerpc_ieee1275 = lib/ieee1275/datetime.c;
  sparc64_ieee1275 = lib/ieee1275/cmos.c;
  powerpc_ieee1275 = lib/ieee1275/cmos.c;
  xen = lib/xen/datetime.c;

  mips_arc = lib/arc/datetime.c;
  enable = noemu;
};

module = {
  name = setjmp;
  common = lib/setjmp.S;
  extra_dist = lib/i386/setjmp.S;
  extra_dist = lib/mips/setjmp.S;
  extra_dist = lib/x86_64/setjmp.S;
  extra_dist = lib/sparc64/setjmp.S;
  extra_dist = lib/powerpc/setjmp.S;
  extra_dist = lib/ia64/setjmp.S;
  extra_dist = lib/ia64/longjmp.S;
  extra_dist = lib/arm/setjmp.S;
  extra_dist = lib/arm64/setjmp.S;
};

module = {
  name = truecrypt;
  i386_pc = loader/i386/pc/truecrypt.c;
  enable = i386_pc;
};

module = {
  name = random;
  x86 = lib/i386/random.c;
  common = lib/random.c;

  i386_multiboot = kern/i386/tsc_pmtimer.c;
  i386_coreboot = kern/i386/tsc_pmtimer.c;
  i386_pc = kern/i386/tsc_pmtimer.c;

  enable = i386_multiboot;
  enable = i386_coreboot;
  enable = i386_pc;
  enable = i386_efi;
  enable = x86_64_efi;
};

module = {
  name = macho;

  common = loader/macho.c;
  common = loader/macho32.c;
  common = loader/macho64.c;
  common = loader/lzss.c;
  extra_dist = loader/machoXX.c;
};

module = {
  name = mmap;
  common = mmap/mmap.c;
  x86 = mmap/i386/uppermem.c;
  x86 = mmap/i386/mmap.c;

  i386_pc = mmap/i386/pc/mmap.c;
  i386_pc = mmap/i386/pc/mmap_helper.S;

  efi = mmap/efi/mmap.c;

  mips = mmap/mips/uppermem.c;

  enable = x86;
  enable = ia64_efi;
  enable = arm_efi;
  enable = arm64_efi;
  enable = mips;
};

module = {
  name = normal;
  common = normal/main.c;
  common = normal/cmdline.c;
  common = normal/dyncmd.c;
  common = normal/auth.c;
  common = normal/autofs.c;
  common = normal/color.c;
  common = normal/completion.c;
  common = normal/datetime.c;
  common = normal/menu.c;
  common = normal/menu_entry.c;
  common = normal/menu_text.c;
  common = normal/misc.c;
  common = normal/crypto.c;
  common = normal/term.c;
  common = normal/context.c;
  common = normal/charset.c;
  common = lib/getline.c;

  common = script/main.c;
  common = script/script.c;
  common = script/execute.c;
  common = script/function.c;
  common = script/lexer.c;
  common = script/argv.c;

  common = commands/menuentry.c;

  common = unidata.c;
  common_nodist = grub_script.tab.c;
  common_nodist = grub_script.yy.c;
  common_nodist = grub_script.tab.h;
  common_nodist = grub_script.yy.h;

  extra_dist = script/yylex.l;
  extra_dist = script/parser.y;

  cflags = '$(CFLAGS_POSIX) -Wno-redundant-decls';
  cppflags = '$(CPPFLAGS_POSIX)';
};

module = {
  name = serial;
  common = term/serial.c;
  x86 = term/ns8250.c;
  ieee1275 = term/ieee1275/serial.c;
  mips_arc = term/arc/serial.c;
  efi = term/efi/serial.c;

  enable = terminfomodule;
  enable = ieee1275;
  enable = mips_arc;
};

module = {
  name = sendkey;
  i386_pc = commands/i386/pc/sendkey.c;
  enable = i386_pc;
};

module = {
  name = terminfo;
  common = term/terminfo.c;
  common = term/tparm.c;
  enable = terminfomodule;
};

module = {
  name = functional_test;
  common = tests/lib/functional_test.c;
  common = tests/lib/test.c;
  common = tests/checksums.h;
};

module = {
  name = exfctest;
  common = tests/example_functional_test.c;
};

module = {
  name = strtoull_test;
  common = tests/strtoull_test.c;
};

module = {
  name = setjmp_test;
  common = tests/setjmp_test.c;
};

module = {
  name = signature_test;
  common = tests/signature_test.c;
  common = tests/signatures.h;
};

module = {
  name = sleep_test;
  common = tests/sleep_test.c;
};

module = {
  name = legacy_password_test;
  common = tests/legacy_password_test.c;
  enable = i386_pc;
  enable = i386_efi;
  enable = x86_64_efi;
  enable = emu;
  enable = xen;
};

module = {
  name = div;
  common = lib/division.c;
  enable = no_softdiv;
};

module = {
  name = div_test;
  common = tests/div_test.c;
};

module = {
  name = mul_test;
  common = tests/mul_test.c;
};

module = {
  name = shift_test;
  common = tests/shift_test.c;
};

module = {
  name = cmp_test;
  common = tests/cmp_test.c;
};

module = {
  name = ctz_test;
  common = tests/ctz_test.c;
};

module = {
  name = bswap_test;
  common = tests/bswap_test.c;
};

module = {
  name = datehook;
  common = hook/datehook.c;
};

module = {
  name = test_blockarg;
  common = tests/test_blockarg.c;
};

module = {
  name = lzopio;
  common = io/lzopio.c;
  common = lib/minilzo/minilzo.c;
  cflags = '$(CFLAGS_POSIX) -Wno-undef -Wno-redundant-decls -Wno-error';
  cppflags = '-I$(srcdir)/lib/posix_wrap -I$(srcdir)/lib/minilzo -DMINILZO_HAVE_CONFIG_H';
};

module = {
  name = testload;
  common = commands/testload.c;
};

module = {
  name = backtrace;
  x86 = lib/i386/backtrace.c;
  i386_xen = lib/i386/backtrace.c;
  x86_64_xen = lib/i386/backtrace.c;
  common = lib/backtrace.c;
  enable = x86;
  enable = i386_xen;
  enable = x86_64_xen;
};

module = {
  name = lsapm;
  common = commands/i386/pc/lsapm.c;
  enable = i386_pc;
};

module = {
  name = keylayouts;
  common = commands/keylayouts.c;
  enable = x86;
};

module = {
  name = priority_queue;
  common = lib/priority_queue.c;
};

module = {
  name = time;
  common = commands/time.c;
};

module = {
  name = cacheinfo;
  common = commands/cacheinfo.c;
  condition = COND_ENABLE_CACHE_STATS;
};

module = {
  name = boottime;
  common = commands/boottime.c;
  condition = COND_ENABLE_BOOT_TIME_STATS;
};

module = {
  name = adler32;
  common = lib/adler32.c;
};

module = {
  name = crc64;
  common = lib/crc64.c;
};

module = {
  name = all_video;
  common = lib/fake_module.c;
};

module = {
  name = gdb;
  common = gdb/cstub.c;
  common = gdb/gdb.c;
  i386 = gdb/i386/idt.c;
  i386 = gdb/i386/machdep.S;
  i386 = gdb/i386/signal.c;
  enable = i386;
};

module = {
  name = testspeed;
  common = commands/testspeed.c;
};

module = {
  name = tr;
  common = commands/tr.c;
};

module = {
  name = progress;
  common = lib/progress.c;
};

module = {
  name = file;
  common = commands/file.c;
  common = commands/file32.c;
  common = commands/file64.c;
  extra_dist = commands/fileXX.c;
  common = loader/i386/xen_file.c;
  common = loader/i386/xen_file32.c;
  common = loader/i386/xen_file64.c;
  extra_dist = loader/i386/xen_fileXX.c;
};

